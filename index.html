<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión de RRHH</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .seccion {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card {
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            border: 1px solid rgba(0, 0, 0, 0.125);
            margin-bottom: 1rem;
        }
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .login-card {
            width: 100%;
            max-width: 400px;
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .login-header {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border-radius: 15px 15px 0 0;
            padding: 2rem;
            text-align: center;
        }
        .user-info {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        .sucursal-cc { border-left: 4px solid #007bff; }
        .sucursal-cde { border-left: 4px solid #28a745; }
        .sucursal-co { border-left: 4px solid #6f42c1; }
        .sucursal-ea { border-left: 4px solid #fd7e14; }
        .sucursal-enc { border-left: 4px solid #e83e8c; }
        .sucursal-lmp { border-left: 4px solid #20c997; }
        .sucursal-lq { border-left: 4px solid #ffc107; }
        .sucursal-sl { border-left: 4px solid #dc3545; }
        
        .badge-cc { background-color: #007bff; }
        .badge-cde { background-color: #28a745; }
        .badge-co { background-color: #6f42c1; }
        .badge-ea { background-color: #fd7e14; }
        .badge-enc { background-color: #e83e8c; }
        .badge-lmp { background-color: #20c997; }
        .badge-lq { background-color: #ffc107; color: #000; }
        .badge-sl { background-color: #dc3545; }
        
        .vacaciones-info {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .antiguedad-badge {
            font-size: 0.8em;
            padding: 4px 8px;
        }
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .notification-item {
            border-left: 4px solid #007bff;
            margin-bottom: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .notification-warning {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        .notification-success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .notification-danger {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        
        /* Mejoras responsivas */
        @media (max-width: 768px) {
            .navbar-nav {
                text-align: center;
            }
            .table-responsive {
                font-size: 0.85rem;
            }
            .card-body {
                padding: 1rem;
            }
            h1, h2 {
                font-size: 1.5rem;
            }
            .user-info {
                font-size: 0.8rem;
                padding: 0.3rem 0.7rem;
                margin-bottom: 0.5rem;
            }
            .dashboard-stats .card-body {
                padding: 0.75rem;
            }
            .dashboard-stats h4 {
                font-size: 1.2rem;
            }
            .btn-group {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
            }
            .btn-group .btn {
                margin-bottom: 0.25rem;
            }
        }
        
        @media (max-width: 576px) {
            .login-card {
                margin: 1rem;
            }
            .card {
                margin-bottom: 0.75rem;
            }
            .table th, .table td {
                padding: 0.5rem;
            }
            .modal-dialog {
                margin: 0.5rem;
            }
            .navbar-brand {
                font-size: 1.1rem;
            }
        }
        
        /* Mejoras para tablas en móviles */
        .table-mobile-friendly {
            width: 100%;
        }
        @media (max-width: 768px) {
            .table-mobile-friendly thead {
                display: none;
            }
            .table-mobile-friendly, 
            .table-mobile-friendly tbody, 
            .table-mobile-friendly tr, 
            .table-mobile-friendly td {
                display: block;
                width: 100%;
            }
            .table-mobile-friendly tr {
                margin-bottom: 1rem;
                border: 1px solid #dee2e6;
                border-radius: 0.375rem;
            }
            .table-mobile-friendly td {
                text-align: right;
                padding-left: 50%;
                position: relative;
                border: none;
                border-bottom: 1px solid #dee2e6;
            }
            .table-mobile-friendly td:before {
                content: attr(data-label);
                position: absolute;
                left: 0.75rem;
                width: 45%;
                padding-right: 0.75rem;
                font-weight: bold;
                text-align: left;
            }
            .table-mobile-friendly td:last-child {
                border-bottom: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="login-container">
        <div class="card login-card">
            <div class="login-header">
                <h2><i class="fas fa-users me-2"></i>Sistema RRHH</h2>
                <p class="mb-0">Conectado a Supabase</p>
            </div>
            <div class="card-body p-4">
                <form id="login-form">
                    <div class="mb-3">
                        <label for="username" class="form-label">Usuario</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-user"></i></span>
                            <input type="text" class="form-control" id="username" value="Admin" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">Contraseña</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-lock"></i></span>
                            <input type="password" class="form-control" id="password" value="1234" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 py-2">
                        <i class="fas fa-sign-in-alt me-2"></i>Iniciar Sesión
                    </button>
                    <div class="mt-3 text-center">
                        <small class="text-muted">
                            Base de datos: Supabase Cloud
                        </small>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main System -->
    <div id="main-system" class="d-none">
        <div class="container-fluid">
            <header class="bg-primary text-white p-3 mb-4">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <h1 class="mb-1"><i class="fas fa-users me-2"></i>Sistema RRHH</h1>
                        <small>Conectado a Supabase - Base de datos en la nube</small>
                    </div>
                    <div class="col-md-6 text-md-end mt-2 mt-md-0">
                        <div class="d-flex flex-column flex-md-row align-items-center justify-content-md-end gap-2">
                            <div class="user-info">
                                <i class="fas fa-database me-1"></i>
                                <span id="current-user">Admin</span>
                            </div>
                            <span id="fecha-actual" class="lead"></span>
                            <div class="btn-group">
                                <button class="btn btn-outline-light btn-sm position-relative" onclick="mostrarSeccion('notificaciones')">
                                    <i class="fas fa-bell"></i>
                                    <span id="notification-counter" class="notification-badge d-none">0</span>
                                </button>
                                <button class="btn btn-outline-light btn-sm" onclick="cerrarSesion()">
                                    <i class="fas fa-sign-out-alt me-1"></i>Salir
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
                <div class="container-fluid">
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav w-100 justify-content-around">
                            <li class="nav-item">
                                <a class="nav-link active" href="#" onclick="mostrarSeccion('dashboard')">
                                    <i class="fas fa-tachometer-alt me-1"></i><span class="d-none d-md-inline">Dashboard</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" onclick="mostrarSeccion('empleados')">
                                    <i class="fas fa-user-tie me-1"></i><span class="d-none d-md-inline">Empleados</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" onclick="mostrarSeccion('agregar-empleado')">
                                    <i class="fas fa-user-plus me-1"></i><span class="d-none d-md-inline">Agregar</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" onclick="mostrarSeccion('vacaciones')">
                                    <i class="fas fa-umbrella-beach me-1"></i><span class="d-none d-md-inline">Vacaciones</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" onclick="mostrarSeccion('sucursales')">
                                    <i class="fas fa-building me-1"></i><span class="d-none d-md-inline">Sucursales</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" onclick="mostrarSeccion('reportes')">
                                    <i class="fas fa-chart-bar me-1"></i><span class="d-none d-md-inline">Reportes</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" onclick="mostrarSeccion('notificaciones')">
                                    <i class="fas fa-bell me-1"></i><span class="d-none d-md-inline">Notificaciones</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>

            <!-- Secciones -->
            <div id="secciones">
                <!-- Dashboard -->
                <div id="dashboard" class="seccion">
                    <div class="row">
                        <div class="col-12">
                            <h2 class="mb-4"><i class="fas fa-tachometer-alt me-2"></i>Dashboard</h2>
                        </div>
                    </div>
                    
                    <div class="row mb-4 dashboard-stats">
                        <div class="col-6 col-md-3 mb-3">
                            <div class="card text-white bg-primary h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 id="total-empleados">0</h4>
                                            <p class="mb-0">Total Empleados</p>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="fas fa-users fa-2x"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6 col-md-3 mb-3">
                            <div class="card text-white bg-success h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 id="vacaciones-pendientes">0</h4>
                                            <p class="mb-0">Días Vac. Pendientes</p>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="fas fa-umbrella-beach fa-2x"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6 col-md-3 mb-3">
                            <div class="card text-white bg-warning h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 id="salario-total">$0</h4>
                                            <p class="mb-0">Nómina Total</p>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="fas fa-dollar-sign fa-2x"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6 col-md-3 mb-3">
                            <div class="card text-white bg-info h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 id="antiguedad-promedio">0</h4>
                                            <p class="mb-0">Antigüedad Promedio</p>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="fas fa-calendar-alt fa-2x"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="card h-100">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">
                                        <i class="fas fa-clock me-2"></i>Empleados Recientes
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div id="lista-empleados-recientes">
                                        <p class="text-muted">Cargando desde Supabase...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="card h-100">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">
                                        <i class="fas fa-bell me-2"></i>Alertas Recientes
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div id="alertas-recientes">
                                        <p class="text-muted">Cargando alertas...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lista de Empleados -->
                <div id="empleados" class="seccion d-none">
                    <div class="row">
                        <div class="col-12">
                            <h2 class="mb-4"><i class="fas fa-user-tie me-2"></i>Lista de Empleados</h2>
                            <div class="card">
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover table-mobile-friendly">
                                            <thead class="table-dark">
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Nombre</th>
                                                    <th>Sucursal</th>
                                                    <th>Puesto</th>
                                                    <th>Antigüedad</th>
                                                    <th>Vac. Pendientes</th>
                                                    <th>Salario</th>
                                                    <th>Acciones</th>
                                                </tr>
                                            </thead>
                                            <tbody id="tabla-empleados">
                                                <tr>
                                                    <td colspan="8" class="text-center text-muted">
                                                        Cargando desde Supabase...
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Agregar Empleado -->
                <div id="agregar-empleado" class="seccion d-none">
                    <div class="row">
                        <div class="col-12">
                            <h2 class="mb-4"><i class="fas fa-user-plus me-2"></i>Agregar Nuevo Empleado</h2>
                            <div class="card">
                                <div class="card-body">
                                    <form id="form-agregar-empleado">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="id_empleado" class="form-label">ID Empleado *</label>
                                                    <input type="text" class="form-control" id="id_empleado" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="nombre" class="form-label">Nombre *</label>
                                                    <input type="text" class="form-control" id="nombre" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="apellido" class="form-label">Apellido *</label>
                                                    <input type="text" class="form-control" id="apellido" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="fecha_contratacion" class="form-label">Fecha de Contratación *</label>
                                                    <input type="date" class="form-control" id="fecha_contratacion" required>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="salario_base" class="form-label">Salario Base *</label>
                                                    <input type="number" step="0.01" class="form-control" id="salario_base" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="puesto" class="form-label">Puesto *</label>
                                                    <input type="text" class="form-control" id="puesto" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="sucursal" class="form-label">Sucursal *</label>
                                                    <select class="form-select" id="sucursal" required>
                                                        <option value="">Seleccionar...</option>
                                                        <option value="CC">CC</option>
                                                        <option value="CDE">CDE</option>
                                                        <option value="CO">CO</option>
                                                        <option value="EA">EA</option>
                                                        <option value="ENC">ENC</option>
                                                        <option value="LMP">LMP</option>
                                                        <option value="LQ">LQ</option>
                                                        <option value="SL">SL</option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="departamento" class="form-label">Departamento</label>
                                                    <input type="text" class="form-control" id="departamento">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="email" class="form-label">Email</label>
                                                    <input type="email" class="form-control" id="email">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="telefono" class="form-label">Teléfono</label>
                                                    <input type="text" class="form-control" id="telefono">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12">
                                                <button type="submit" class="btn btn-success btn-lg w-100 mb-2">
                                                    <i class="fas fa-save me-2"></i>Guardar en Supabase
                                                </button>
                                                <button type="button" class="btn btn-secondary btn-lg w-100" onclick="mostrarSeccion('empleados')">
                                                    <i class="fas fa-times me-2"></i>Cancelar
                                                </button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Vacaciones -->
                <div id="vacaciones" class="seccion d-none">
                    <div class="row">
                        <div class="col-12">
                            <h2 class="mb-4"><i class="fas fa-umbrella-beach me-2"></i>Gestión de Vacaciones</h2>
                            <div class="alert alert-info">
                                <strong><i class="fas fa-info-circle me-2"></i>Política de Vacaciones:</strong><br>
                                • 1 año de servicio: 12 días hábiles<br>
                                • 5-10 años de servicio: 18 días hábiles<br>
                                • Más de 10 años: 30 días hábiles
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover table-mobile-friendly">
                                            <thead class="table-dark">
                                                <tr>
                                                    <th>Empleado</th>
                                                    <th>Sucursal</th>
                                                    <th>Antigüedad</th>
                                                    <th>Vac. Acumuladas</th>
                                                    <th>Vac. Tomadas</th>
                                                    <th>Vac. Pendientes</th>
                                                    <th>Acciones</th>
                                                </tr>
                                            </thead>
                                            <tbody id="tabla-vacaciones">
                                                <tr>
                                                    <td colspan="7" class="text-center text-muted">
                                                        Cargando desde Supabase...
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sucursales -->
                <div id="sucursales" class="seccion d-none">
                    <div class="row">
                        <div class="col-12">
                            <h2 class="mb-4"><i class="fas fa-building me-2"></i>Resumen por Sucursales</h2>
                            <div class="row mb-4">
                                <div class="col-6 col-md-3 mb-3">
                                    <div class="card text-white bg-primary h-100">
                                        <div class="card-body text-center">
                                            <h3 id="total-sucursales">0</h3>
                                            <p class="mb-0">Sucursales Activas</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3 mb-3">
                                    <div class="card text-white bg-success h-100">
                                        <div class="card-body text-center">
                                            <h3 id="empleados-cc">0</h3>
                                            <p class="mb-0">Empleados CC</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3 mb-3">
                                    <div class="card text-white bg-warning h-100">
                                        <div class="card-body text-center">
                                            <h3 id="empleados-cde">0</h3>
                                            <p class="mb-0">Empleados CDE</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3 mb-3">
                                    <div class="card text-white bg-info h-100">
                                        <div class="card-body text-center">
                                            <h3 id="empleados-co">0</h3>
                                            <p class="mb-0">Empleados CO</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row" id="resumen-sucursales">
                                <!-- Se llena dinámicamente con JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reportes -->
                <div id="reportes" class="seccion d-none">
                    <div class="row">
                        <div class="col-12">
                            <h2 class="mb-4"><i class="fas fa-chart-bar me-2"></i>Reportes y Exportaciones</h2>
                            
                            <div class="row mb-4">
                                <div class="col-md-4 mb-3">
                                    <div class="card h-100">
                                        <div class="card-body text-center">
                                            <i class="fas fa-file-pdf fa-3x text-danger mb-3"></i>
                                            <h5>Reporte General</h5>
                                            <p class="text-muted">Lista completa de empleados</p>
                                            <button class="btn btn-danger" onclick="generarReporteGeneral()">
                                                <i class="fas fa-download me-2"></i>Descargar PDF
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="card h-100">
                                        <div class="card-body text-center">
                                            <i class="fas fa-umbrella-beach fa-3x text-warning mb-3"></i>
                                            <h5>Reporte de Vacaciones</h5>
                                            <p class="text-muted">Estado de vacaciones por empleado</p>
                                            <button class="btn btn-warning" onclick="generarReporteVacaciones()">
                                                <i class="fas fa-download me-2"></i>Descargar PDF
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="card h-100">
                                        <div class="card-body text-center">
                                            <i class="fas fa-building fa-3x text-primary mb-3"></i>
                                            <h5>Reporte por Sucursal</h5>
                                            <p class="text-muted">Empleados por sucursal</p>
                                            <button class="btn btn-primary" onclick="generarReporteSucursales()">
                                                <i class="fas fa-download me-2"></i>Descargar PDF
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <div class="card h-100">
                                        <div class="card-body text-center">
                                            <i class="fas fa-file-excel fa-3x text-success mb-3"></i>
                                            <h5>Exportar a Excel</h5>
                                            <p class="text-muted">Datos completos en formato Excel</p>
                                            <button class="btn btn-success" onclick="exportarAExcel()">
                                                <i class="fas fa-file-export me-2"></i>Exportar CSV
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="card h-100">
                                        <div class="card-body text-center">
                                            <i class="fas fa-chart-pie fa-3x text-info mb-3"></i>
                                            <h5>Estadísticas</h5>
                                            <p class="text-muted">Métricas y análisis</p>
                                            <button class="btn btn-info" onclick="generarReporteEstadisticas()">
                                                <i class="fas fa-chart-bar me-2"></i>Ver Reporte
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notificaciones -->
                <div id="notificaciones" class="seccion d-none">
                    <div class="row">
                        <div class="col-12">
                            <h2 class="mb-4"><i class="fas fa-bell me-2"></i>Sistema de Notificaciones</h2>
                            
                            <div class="row mb-4">
                                <div class="col-md-4 mb-3">
                                    <div class="card h-100">
                                        <div class="card-body text-center">
                                            <i class="fas fa-umbrella-beach fa-3x text-warning mb-3"></i>
                                            <h5>Vacaciones Próximas</h5>
                                            <p id="contador-vacaciones-proximas" class="h4 text-warning">0</p>
                                            <small>Empleados con vacaciones próximas</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="card h-100">
                                        <div class="card-body text-center">
                                            <i class="fas fa-birthday-cake fa-3x text-success mb-3"></i>
                                            <h5>Cumpleaños</h5>
                                            <p id="contador-cumpleanos" class="h4 text-success">0</p>
                                            <small>Cumpleaños este mes</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="card h-100">
                                        <div class="card-body text-center">
                                            <i class="fas fa-calendar-alt fa-3x text-info mb-3"></i>
                                            <h5>Aniversarios</h5>
                                            <p id="contador-aniversarios" class="h4 text-info">0</p>
                                            <small>Aniversarios este mes</small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">
                                        <i class="fas fa-list me-2"></i>Alertas y Recordatorios
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div id="lista-notificaciones">
                                        <p class="text-muted">Cargando notificaciones...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Vacaciones -->
    <div class="modal fade" id="modalVacaciones" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Registrar Vacaciones</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="form-vacaciones">
                        <input type="hidden" id="empleado_vacaciones_id">
                        <div class="mb-3">
                            <label for="dias_vacaciones" class="form-label">Días hábiles a tomar:</label>
                            <input type="number" class="form-control" id="dias_vacaciones" min="1" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Información del Empleado:</label>
                            <div class="alert alert-info">
                                <strong id="info-empleado"></strong><br>
                                Sucursal: <span id="info-sucursal" class="badge"></span><br>
                                Antigüedad: <span id="info-antiguedad" class="badge bg-primary"></span><br>
                                Vacaciones acumuladas: <span id="info-vacaciones-acumuladas" class="badge bg-info"></span><br>
                                Vacaciones pendientes: <span id="info-vacaciones-pendientes" class="badge bg-success"></span>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="registrarVacaciones()">Registrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Editar Empleado -->
    <div class="modal fade" id="modalEditarEmpleado" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Editar Empleado</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="form-editar-empleado">
                        <input type="hidden" id="edit_empleado_id">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="edit_id_empleado" class="form-label">ID Empleado *</label>
                                    <input type="text" class="form-control" id="edit_id_empleado" readonly>
                                    <small class="text-muted">El ID no se puede modificar</small>
                                </div>
                                <div class="mb-3">
                                    <label for="edit_nombre" class="form-label">Nombre *</label>
                                    <input type="text" class="form-control" id="edit_nombre" required>
                                </div>
                                <div class="mb-3">
                                    <label for="edit_apellido" class="form-label">Apellido *</label>
                                    <input type="text" class="form-control" id="edit_apellido" required>
                                </div>
                                <div class="mb-3">
                                    <label for="edit_fecha_contratacion" class="form-label">Fecha de Contratación *</label>
                                    <input type="date" class="form-control" id="edit_fecha_contratacion" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="edit_salario_base" class="form-label">Salario Base *</label>
                                    <input type="number" step="0.01" class="form-control" id="edit_salario_base" required>
                                </div>
                                <div class="mb-3">
                                    <label for="edit_puesto" class="form-label">Puesto *</label>
                                    <input type="text" class="form-control" id="edit_puesto" required>
                                </div>
                                <div class="mb-3">
                                    <label for="edit_sucursal" class="form-label">Sucursal *</label>
                                    <select class="form-select" id="edit_sucursal" required>
                                        <option value="">Seleccionar...</option>
                                        <option value="CC">CC</option>
                                        <option value="CDE">CDE</option>
                                        <option value="CO">CO</option>
                                        <option value="EA">EA</option>
                                        <option value="ENC">ENC</option>
                                        <option value="LMP">LMP</option>
                                        <option value="LQ">LQ</option>
                                        <option value="SL">SL</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="edit_departamento" class="form-label">Departamento</label>
                                    <input type="text" class="form-control" id="edit_departamento">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="edit_email" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="edit_email">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="edit_telefono" class="form-label">Teléfono</label>
                                    <input type="text" class="form-control" id="edit_telefono">
                                </div>
                            </div>
                        </div>
                        <!-- Sección de Vacaciones -->
                        <div class="vacaciones-info">
                            <h6><i class="fas fa-umbrella-beach me-2"></i>Control de Vacaciones</h6>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="edit_dias_vacaciones_tomados" class="form-label text-white">Días Tomados *</label>
                                        <input type="number" class="form-control" id="edit_dias_vacaciones_tomados" min="0" required>
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <div class="mb-3">
                                        <label class="form-label text-white">Resumen de Vacaciones</label>
                                        <div class="text-white">
                                            <div>Antigüedad: <strong id="edit_antiguedad_info">0 años</strong></div>
                                            <div>Rango: <strong id="edit_rango_antiguedad">-</strong></div>
                                            <div>Vacaciones acumuladas: <strong id="edit_vacaciones_acumuladas">0 días</strong></div>
                                            <div>Vacaciones pendientes: <strong id="edit_vacaciones_pendientes">0 días</strong></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="guardarEdicionEmpleado()">
                        <i class="fas fa-save me-1"></i>Guardar Cambios
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Configuración Supabase
        const SUPABASE_URL = 'https://pqbbqrzofojiupnannti.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBxYmJxcnpvZm9qaXVwbmFubnRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxNTM3MzksImV4cCI6MjA3NzcyOTczOX0.LeDcjVgQlGln1yLMtaltNN4gK0dly0RmBtSdI1t5fck';
        
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        let empleados = [];
        let notificaciones = [];

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Sistema RRHH con Supabase iniciado');
            document.getElementById('login-form').addEventListener('submit', iniciarSesion);
            document.getElementById('form-agregar-empleado').addEventListener('submit', agregarEmpleado);
            document.getElementById('edit_fecha_contratacion').addEventListener('change', actualizarCalculosVacaciones);
            
            // Añadir etiquetas de datos para tablas responsivas
            actualizarTablasResponsivas();
        });

        // ========== FUNCIONES PRINCIPALES ==========

        async function iniciarSesion(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Validación simple (en un sistema real esto sería más seguro)
            if (username === 'Admin' && password === '1234') {
                document.getElementById('login-screen').classList.add('d-none');
                document.getElementById('main-system').classList.remove('d-none');
                document.getElementById('current-user').textContent = username;
                
                // Actualizar fecha actual
                const fecha = new Date();
                document.getElementById('fecha-actual').textContent = fecha.toLocaleDateString('es-ES', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                // Cargar datos iniciales
                await cargarEmpleados();
                mostrarSeccion('dashboard');
            } else {
                alert('Usuario o contraseña incorrectos');
            }
        }

        function cerrarSesion() {
            document.getElementById('main-system').classList.add('d-none');
            document.getElementById('login-screen').classList.remove('d-none');
            document.getElementById('username').value = 'Admin';
            document.getElementById('password').value = '1234';
        }

        function mostrarSeccion(seccionId) {
            // Ocultar todas las secciones
            document.querySelectorAll('.seccion').forEach(seccion => {
                seccion.classList.add('d-none');
            });
            
            // Mostrar la sección seleccionada
            document.getElementById(seccionId).classList.remove('d-none');
            
            // Actualizar navegación activa
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Encontrar el enlace correspondiente a la sección
            const navLinks = document.querySelectorAll('.nav-link');
            for (let link of navLinks) {
                if (link.getAttribute('onclick') && link.getAttribute('onclick').includes(seccionId)) {
                    link.classList.add('active');
                    break;
                }
            }
            
            // Actualizar tablas responsivas
            setTimeout(actualizarTablasResponsivas, 100);
        }

        // ========== GESTIÓN DE EMPLEADOS ==========

        async function cargarEmpleados() {
            try {
                console.log('Cargando empleados desde Supabase...');
                
                const { data, error } = await supabaseClient
                    .from('empleados')
                    .select('*')
                    .order('fecha_contratacion', { ascending: false });
                
                if (error) {
                    throw error;
                }
                
                empleados = data || [];
                console.log(`Se cargaron ${empleados.length} empleados`);
                
                actualizarDashboard();
                actualizarTablaEmpleados();
                actualizarTablaVacaciones();
                actualizarResumenSucursales();
                generarNotificaciones();
                actualizarAlertasRecientes();
                
            } catch (error) {
                console.error('Error cargando empleados:', error);
                // Para desarrollo, cargar datos de ejemplo si hay error
                cargarDatosEjemplo();
            }
        }

        function cargarDatosEjemplo() {
            console.log('Cargando datos de ejemplo...');
            empleados = [
                {
                    id_empleado: 'EMP001',
                    nombre: 'Juan',
                    apellido: 'Pérez',
                    fecha_contratacion: '2020-03-15',
                    salario_base: 2500.00,
                    puesto: 'Gerente',
                    sucursal: 'CC',
                    departamento: 'Administración',
                    email: 'juan.perez@empresa.com',
                    telefono: '+1234567890',
                    dias_vacaciones_tomados: 5
                },
                {
                    id_empleado: 'EMP002',
                    nombre: 'María',
                    apellido: 'González',
                    fecha_contratacion: '2021-06-01',
                    salario_base: 1800.00,
                    puesto: 'Analista',
                    sucursal: 'CDE',
                    departamento: 'TI',
                    email: 'maria.gonzalez@empresa.com',
                    telefono: '+1234567891',
                    dias_vacaciones_tomados: 12
                },
                {
                    id_empleado: 'EMP003',
                    nombre: 'Carlos',
                    apellido: 'López',
                    fecha_contratacion: '2019-11-20',
                    salario_base: 2200.00,
                    puesto: 'Supervisor',
                    sucursal: 'CO',
                    departamento: 'Operaciones',
                    email: 'carlos.lopez@empresa.com',
                    telefono: '+1234567892',
                    dias_vacaciones_tomados: 8
                }
            ];
            
            actualizarDashboard();
            actualizarTablaEmpleados();
            actualizarTablaVacaciones();
            actualizarResumenSucursales();
            generarNotificaciones();
            actualizarAlertasRecientes();
        }

        async function agregarEmpleado(event) {
            event.preventDefault();
            
            try {
                const nuevoEmpleado = {
                    id_empleado: document.getElementById('id_empleado').value,
                    nombre: document.getElementById('nombre').value,
                    apellido: document.getElementById('apellido').value,
                    fecha_contratacion: document.getElementById('fecha_contratacion').value,
                    salario_base: parseFloat(document.getElementById('salario_base').value),
                    puesto: document.getElementById('puesto').value,
                    sucursal: document.getElementById('sucursal').value,
                    departamento: document.getElementById('departamento').value,
                    email: document.getElementById('email').value,
                    telefono: document.getElementById('telefono').value,
                    dias_vacaciones_tomados: 0
                };
                
                console.log('Agregando empleado:', nuevoEmpleado);
                
                const { data, error } = await supabaseClient
                    .from('empleados')
                    .insert([nuevoEmpleado]);
                
                if (error) {
                    throw error;
                }
                
                alert('Empleado agregado exitosamente a Supabase');
                document.getElementById('form-agregar-empleado').reset();
                
                // Recargar la lista de empleados
                await cargarEmpleados();
                mostrarSeccion('empleados');
                
            } catch (error) {
                console.error('Error agregando empleado:', error);
                alert('Error al agregar empleado: ' + error.message);
            }
        }

        function editarEmpleado(idEmpleado) {
            const empleado = empleados.find(emp => emp.id_empleado === idEmpleado);
            if (!empleado) return;
            
            // Llenar el formulario con los datos del empleado
            document.getElementById('edit_empleado_id').value = empleado.id;
            document.getElementById('edit_id_empleado').value = empleado.id_empleado;
            document.getElementById('edit_nombre').value = empleado.nombre;
            document.getElementById('edit_apellido').value = empleado.apellido;
            document.getElementById('edit_fecha_contratacion').value = empleado.fecha_contratacion;
            document.getElementById('edit_salario_base').value = empleado.salario_base;
            document.getElementById('edit_puesto').value = empleado.puesto;
            document.getElementById('edit_sucursal').value = empleado.sucursal;
            document.getElementById('edit_departamento').value = empleado.departamento || '';
            document.getElementById('edit_email').value = empleado.email || '';
            document.getElementById('edit_telefono').value = empleado.telefono || '';
            document.getElementById('edit_dias_vacaciones_tomados').value = empleado.dias_vacaciones_tomados || 0;
            
            // Actualizar cálculos de vacaciones
            actualizarCalculosVacaciones();
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('modalEditarEmpleado'));
            modal.show();
        }

        async function guardarEdicionEmpleado() {
            try {
                const empleadoActualizado = {
                    id_empleado: document.getElementById('edit_id_empleado').value,
                    nombre: document.getElementById('edit_nombre').value,
                    apellido: document.getElementById('edit_apellido').value,
                    fecha_contratacion: document.getElementById('edit_fecha_contratacion').value,
                    salario_base: parseFloat(document.getElementById('edit_salario_base').value),
                    puesto: document.getElementById('edit_puesto').value,
                    sucursal: document.getElementById('edit_sucursal').value,
                    departamento: document.getElementById('edit_departamento').value,
                    email: document.getElementById('edit_email').value,
                    telefono: document.getElementById('edit_telefono').value,
                    dias_vacaciones_tomados: parseInt(document.getElementById('edit_dias_vacaciones_tomados').value) || 0
                };
                
                const { data, error } = await supabaseClient
                    .from('empleados')
                    .update(empleadoActualizado)
                    .eq('id_empleado', empleadoActualizado.id_empleado);
                
                if (error) {
                    throw error;
                }
                
                alert('Empleado actualizado exitosamente');
                const modal = bootstrap.Modal.getInstance(document.getElementById('modalEditarEmpleado'));
                modal.hide();
                
                await cargarEmpleados();
                
            } catch (error) {
                console.error('Error actualizando empleado:', error);
                alert('Error al actualizar empleado: ' + error.message);
            }
        }

        async function eliminarEmpleado(idEmpleado) {
            if (!confirm('¿Está seguro de que desea eliminar este empleado?')) {
                return;
            }
            
            try {
                const { error } = await supabaseClient
                    .from('empleados')
                    .delete()
                    .eq('id_empleado', idEmpleado);
                
                if (error) {
                    throw error;
                }
                
                alert('Empleado eliminado exitosamente');
                await cargarEmpleados();
                
            } catch (error) {
                console.error('Error eliminando empleado:', error);
                alert('Error al eliminar empleado: ' + error.message);
            }
        }

        // ========== CÁLCULOS Y UTILIDADES ==========

        function calcularAntiguedad(fechaContratacion) {
            const hoy = new Date();
            const fechaContrato = new Date(fechaContratacion);
            const diferencia = hoy.getTime() - fechaContrato.getTime();
            const años = diferencia / (1000 * 3600 * 24 * 365.25);
            return Math.floor(años);
        }

        function calcularVacaciones(antiguedad) {
            if (antiguedad < 1) return 0;
            if (antiguedad < 5) return 12;
            if (antiguedad < 10) return 18;
            return 30;
        }

        function actualizarCalculosVacaciones() {
            const fechaContratacion = document.getElementById('edit_fecha_contratacion').value;
            const diasTomados = parseInt(document.getElementById('edit_dias_vacaciones_tomados').value) || 0;
            
            if (!fechaContratacion) return;
            
            const antiguedad = calcularAntiguedad(fechaContratacion);
            const vacacionesAcumuladas = calcularVacaciones(antiguedad);
            const vacacionesPendientes = Math.max(0, vacacionesAcumuladas - diasTomados);
            
            document.getElementById('edit_antiguedad_info').textContent = `${antiguedad} año${antiguedad !== 1 ? 's' : ''}`;
            document.getElementById('edit_vacaciones_acumuladas').textContent = `${vacacionesAcumuladas} días`;
            document.getElementById('edit_vacaciones_pendientes').textContent = `${vacacionesPendientes} días`;
            
            // Determinar rango de antigüedad
            let rango = 'Menos de 1 año';
            if (antiguedad >= 1 && antiguedad < 5) rango = '1-4 años (12 días)';
            else if (antiguedad >= 5 && antiguedad < 10) rango = '5-9 años (18 días)';
            else if (antiguedad >= 10) rango = '10+ años (30 días)';
            
            document.getElementById('edit_rango_antiguedad').textContent = rango;
        }

        // ========== ACTUALIZACIÓN DE INTERFACES ==========

        function actualizarDashboard() {
            // Total empleados
            document.getElementById('total-empleados').textContent = empleados.length;
            
            // Vacaciones pendientes totales
            let totalVacacionesPendientes = 0;
            empleados.forEach(emp => {
                const antiguedad = calcularAntiguedad(emp.fecha_contratacion);
                const vacacionesAcumuladas = calcularVacaciones(antiguedad);
                const vacacionesPendientes = Math.max(0, vacacionesAcumuladas - (emp.dias_vacaciones_tomados || 0));
                totalVacacionesPendientes += vacacionesPendientes;
            });
            document.getElementById('vacaciones-pendientes').textContent = totalVacacionesPendientes;
            
            // Salario total
            const salarioTotal = empleados.reduce((total, emp) => total + parseFloat(emp.salario_base || 0), 0);
            document.getElementById('salario-total').textContent = '$' + salarioTotal.toLocaleString('es-ES');
            
            // Antigüedad promedio
            const antiguedadPromedio = empleados.length > 0 
                ? empleados.reduce((total, emp) => total + calcularAntiguedad(emp.fecha_contratacion), 0) / empleados.length 
                : 0;
            document.getElementById('antiguedad-promedio').textContent = antiguedadPromedio.toFixed(1) + ' años';
            
            // Empleados recientes
            actualizarListaEmpleadosRecientes();
        }

        function actualizarListaEmpleadosRecientes() {
            const container = document.getElementById('lista-empleados-recientes');
            const empleadosRecientes = empleados.slice(0, 5);
            
            if (empleadosRecientes.length === 0) {
                container.innerHTML = '<p class="text-muted text-center">No hay empleados registrados</p>';
                return;
            }
            
            const html = empleadosRecientes.map(emp => `
                <div class="d-flex align-items-center border-bottom py-2">
                    <div class="flex-shrink-0">
                        <i class="fas fa-user-circle fa-2x text-primary"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="mb-0">${emp.nombre} ${emp.apellido}</h6>
                        <small class="text-muted">${emp.puesto} - ${emp.sucursal}</small>
                    </div>
                    <div class="flex-shrink-0">
                        <span class="badge bg-primary">${calcularAntiguedad(emp.fecha_contratacion)} años</span>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        function actualizarTablaEmpleados() {
            const tbody = document.getElementById('tabla-empleados');
            
            if (empleados.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center text-muted">
                            No hay empleados registrados
                        </td>
                    </tr>
                `;
                return;
            }
            
            const html = empleados.map(emp => {
                const antiguedad = calcularAntiguedad(emp.fecha_contratacion);
                const vacacionesAcumuladas = calcularVacaciones(antiguedad);
                const vacacionesPendientes = Math.max(0, vacacionesAcumuladas - (emp.dias_vacaciones_tomados || 0));
                
                return `
                    <tr>
                        <td data-label="ID">${emp.id_empleado}</td>
                        <td data-label="Nombre">${emp.nombre} ${emp.apellido}</td>
                        <td data-label="Sucursal">
                            <span class="badge badge-${emp.sucursal.toLowerCase()}">${emp.sucursal}</span>
                        </td>
                        <td data-label="Puesto">${emp.puesto}</td>
                        <td data-label="Antigüedad">
                            <span class="badge bg-primary antiguedad-badge">${antiguedad} años</span>
                        </td>
                        <td data-label="Vac. Pendientes">${vacacionesPendientes} días</td>
                        <td data-label="Salario">$${parseFloat(emp.salario_base).toLocaleString('es-ES')}</td>
                        <td data-label="Acciones">
                            <div class="btn-group btn-group-sm" role="group">
                                <button class="btn btn-outline-primary" onclick="editarEmpleado('${emp.id_empleado}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="eliminarEmpleado('${emp.id_empleado}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            tbody.innerHTML = html;
        }

        function actualizarTablaVacaciones() {
            const tbody = document.getElementById('tabla-vacaciones');
            
            if (empleados.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center text-muted">
                            No hay empleados registrados
                        </td>
                    </tr>
                `;
                return;
            }
            
            const html = empleados.map(emp => {
                const antiguedad = calcularAntiguedad(emp.fecha_contratacion);
                const vacacionesAcumuladas = calcularVacaciones(antiguedad);
                const vacacionesPendientes = Math.max(0, vacacionesAcumuladas - (emp.dias_vacaciones_tomados || 0));
                
                return `
                    <tr>
                        <td data-label="Empleado">${emp.nombre} ${emp.apellido}</td>
                        <td data-label="Sucursal">
                            <span class="badge badge-${emp.sucursal.toLowerCase()}">${emp.sucursal}</span>
                        </td>
                        <td data-label="Antigüedad">${antiguedad} años</td>
                        <td data-label="Vac. Acumuladas">${vacacionesAcumuladas} días</td>
                        <td data-label="Vac. Tomadas">${emp.dias_vacaciones_tomados || 0} días</td>
                        <td data-label="Vac. Pendientes">
                            <span class="badge ${vacacionesPendientes > 0 ? 'bg-success' : 'bg-secondary'}">
                                ${vacacionesPendientes} días
                            </span>
                        </td>
                        <td data-label="Acciones">
                            <button class="btn btn-sm btn-outline-warning" onclick="abrirModalVacaciones('${emp.id_empleado}')">
                                <i class="fas fa-umbrella-beach me-1"></i>Registrar
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
            
            tbody.innerHTML = html;
        }

        function actualizarResumenSucursales() {
            // Contadores por sucursal
            const contadores = {
                'CC': 0, 'CDE': 0, 'CO': 0, 'EA': 0,
                'ENC': 0, 'LMP': 0, 'LQ': 0, 'SL': 0
            };
            
            empleados.forEach(emp => {
                if (emp.sucursal && contadores.hasOwnProperty(emp.sucursal)) {
                    contadores[emp.sucursal]++;
                }
            });
            
            // Actualizar tarjetas
            document.getElementById('total-sucursales').textContent = Object.keys(contadores).length;
            document.getElementById('empleados-cc').textContent = contadores.CC;
            document.getElementById('empleados-cde').textContent = contadores.CDE;
            document.getElementById('empleados-co').textContent = contadores.CO;
            
            // Actualizar resumen detallado
            const container = document.getElementById('resumen-sucursales');
            const sucursalesActivas = Object.keys(contadores).filter(sucursal => contadores[sucursal] > 0);
            
            if (sucursalesActivas.length === 0) {
                container.innerHTML = '<div class="col-12"><p class="text-muted text-center">No hay empleados en sucursales</p></div>';
                return;
            }
            
            const html = sucursalesActivas.map(sucursal => {
                const empleadosSucursal = empleados.filter(emp => emp.sucursal === sucursal);
                const salarioPromedio = empleadosSucursal.length > 0 
                    ? empleadosSucursal.reduce((total, emp) => total + parseFloat(emp.salario_base || 0), 0) / empleadosSucursal.length
                    : 0;
                
                return `
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="card sucursal-${sucursal.toLowerCase()}">
                            <div class="card-body">
                                <h5 class="card-title">
                                    <i class="fas fa-building me-2"></i>Sucursal ${sucursal}
                                </h5>
                                <div class="row">
                                    <div class="col-6">
                                        <strong>${contadores[sucursal]}</strong>
                                        <small class="text-muted d-block">Empleados</small>
                                    </div>
                                    <div class="col-6">
                                        <strong>$${salarioPromedio.toLocaleString('es-ES', {maximumFractionDigits: 0})}</strong>
                                        <small class="text-muted d-block">Salario promedio</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
        }

        // ========== FUNCIONES PARA TABLAS RESPONSIVAS ==========

        function actualizarTablasResponsivas() {
            // Añadir etiquetas de datos para tablas responsivas
            document.querySelectorAll('.table-mobile-friendly th').forEach((th, index) => {
                const label = th.textContent;
                document.querySelectorAll('.table-mobile-friendly td:nth-child(' + (index + 1) + ')').forEach(td => {
                    td.setAttribute('data-label', label);
                });
            });
        }

        // ========== GESTIÓN DE VACACIONES ==========

        function abrirModalVacaciones(idEmpleado) {
            const empleado = empleados.find(emp => emp.id_empleado === idEmpleado);
            if (!empleado) return;
            
            const antiguedad = calcularAntiguedad(empleado.fecha_contratacion);
            const vacacionesAcumuladas = calcularVacaciones(antiguedad);
            const vacacionesPendientes = Math.max(0, vacacionesAcumuladas - (empleado.dias_vacaciones_tomados || 0));
            
            document.getElementById('empleado_vacaciones_id').value = idEmpleado;
            document.getElementById('info-empleado').textContent = `${empleado.nombre} ${empleado.apellido}`;
            document.getElementById('info-sucursal').textContent = empleado.sucursal;
            document.getElementById('info-sucursal').className = `badge badge-${empleado.sucursal.toLowerCase()}`;
            document.getElementById('info-antiguedad').textContent = `${antiguedad} años`;
            document.getElementById('info-vacaciones-acumuladas').textContent = `${vacacionesAcumuladas} días`;
            document.getElementById('info-vacaciones-pendientes').textContent = `${vacacionesPendientes} días`;
            
            const modal = new bootstrap.Modal(document.getElementById('modalVacaciones'));
            modal.show();
        }

        async function registrarVacaciones() {
            try {
                const idEmpleado = document.getElementById('empleado_vacaciones_id').value;
                const diasVacaciones = parseInt(document.getElementById('dias_vacaciones').value);
                
                if (!idEmpleado || !diasVacaciones || diasVacaciones <= 0) {
                    alert('Por favor ingrese un número válido de días');
                    return;
                }
                
                const empleado = empleados.find(emp => emp.id_empleado === idEmpleado);
                if (!empleado) {
                    alert('Empleado no encontrado');
                    return;
                }
                
                const antiguedad = calcularAntiguedad(empleado.fecha_contratacion);
                const vacacionesAcumuladas = calcularVacaciones(antiguedad);
                const vacacionesPendientes = Math.max(0, vacacionesAcumuladas - (empleado.dias_vacaciones_tomados || 0));
                
                if (diasVacaciones > vacacionesPendientes) {
                    alert(`No hay suficientes días disponibles. Días pendientes: ${vacacionesPendientes}`);
                    return;
                }
                
                const nuevosDiasTomados = (empleado.dias_vacaciones_tomados || 0) + diasVacaciones;
                
                const { error } = await supabaseClient
                    .from('empleados')
                    .update({ dias_vacaciones_tomados: nuevosDiasTomados })
                    .eq('id_empleado', idEmpleado);
                
                if (error) {
                    throw error;
                }
                
                alert(`Vacaciones registradas exitosamente: ${diasVacaciones} días para ${empleado.nombre} ${empleado.apellido}`);
                
                const modal = bootstrap.Modal.getInstance(document.getElementById('modalVacaciones'));
                modal.hide();
                
                await cargarEmpleados();
                
            } catch (error) {
                console.error('Error registrando vacaciones:', error);
                alert('Error al registrar vacaciones: ' + error.message);
            }
        }

        // ========== MÓDULO DE NOTIFICACIONES ==========
        function generarNotificaciones() {
            notificaciones = [];
            const hoy = new Date();
            const mesActual = hoy.getMonth() + 1;
            
            // Notificaciones de vacaciones
            empleados.forEach(emp => {
                const antiguedad = calcularAntiguedad(emp.fecha_contratacion);
                const vacacionesPendientes = Math.max(0, calcularVacaciones(antiguedad) - (emp.dias_vacaciones_tomados || 0));
                
                if (vacacionesPendientes >= 10) {
                    notificaciones.push({
                        tipo: 'warning',
                        titulo: 'Vacaciones Pendientes',
                        mensaje: `${emp.nombre} ${emp.apellido} tiene ${vacacionesPendientes} días de vacaciones pendientes`,
                        fecha: new Date(),
                        icono: 'fa-umbrella-beach'
                    });
                }
            });

            // Notificaciones de cumpleaños (simuladas)
            const cumpleanosEsteMes = empleados.filter(emp => {
                // Simulación - en un sistema real usaríamos la fecha real de nacimiento
                return Math.random() > 0.7; // 30% de empleados "cumplen" este mes
            }).slice(0, 3);

            cumpleanosEsteMes.forEach(emp => {
                notificaciones.push({
                    tipo: 'success',
                    titulo: 'Cumpleaños',
                    mensaje: `${emp.nombre} ${emp.apellido} cumple años este mes`,
                    fecha: new Date(),
                    icono: 'fa-birthday-cake'
                });
            });

            // Notificaciones de aniversarios
            empleados.forEach(emp => {
                const antiguedad = calcularAntiguedad(emp.fecha_contratacion);
                if (antiguedad > 0 && hoy.getDate() === 15) { // Simulación: día 15 de cada mes
                    notificaciones.push({
                        tipo: 'info',
                        titulo: 'Aniversario',
                        mensaje: `${emp.nombre} ${emp.apellido} cumple ${antiguedad} año${antiguedad !== 1 ? 's' : ''} en la empresa`,
                        fecha: new Date(),
                        icono: 'fa-calendar-alt'
                    });
                }
            });

            actualizarInterfazNotificaciones();
        }

        function actualizarInterfazNotificaciones() {
            // Actualizar contador
            const counter = document.getElementById('notification-counter');
            if (notificaciones.length > 0) {
                counter.textContent = notificaciones.length;
                counter.classList.remove('d-none');
            } else {
                counter.classList.add('d-none');
            }

            // Actualizar dashboard
            const vacacionesProximas = notificaciones.filter(n => n.tipo === 'warning').length;
            const cumpleanos = notificaciones.filter(n => n.tipo === 'success').length;
            const aniversarios = notificaciones.filter(n => n.tipo === 'info').length;

            document.getElementById('contador-vacaciones-proximas').textContent = vacacionesProximas;
            document.getElementById('contador-cumpleanos').textContent = cumpleanos;
            document.getElementById('contador-aniversarios').textContent = aniversarios;

            // Actualizar lista de notificaciones
            const lista = document.getElementById('lista-notificaciones');
            if (notificaciones.length === 0) {
                lista.innerHTML = '<p class="text-muted text-center">No hay notificaciones pendientes</p>';
                return;
            }

            const html = notificaciones.map(notif => `
                <div class="notification-item notification-${notif.tipo}">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <i class="fas ${notif.icono} me-2"></i>
                            <strong>${notif.titulo}</strong>
                            <p class="mb-1">${notif.mensaje}</p>
                            <small class="text-muted">${notif.fecha.toLocaleDateString('es-ES')}</small>
                        </div>
                        <button class="btn btn-sm btn-outline-secondary" onclick="marcarComoLeida(this)">
                            <i class="fas fa-check"></i>
                        </button>
                    </div>
                </div>
            `).join('');

            lista.innerHTML = html;
        }

        function marcarComoLeida(boton) {
            const notificacion = boton.closest('.notification-item');
            notificacion.style.opacity = '0.5';
            setTimeout(() => {
                notificacion.remove();
                // Actualizar contador
                const notificacionesRestantes = document.querySelectorAll('.notification-item').length;
                const counter = document.getElementById('notification-counter');
                if (notificacionesRestantes > 0) {
                    counter.textContent = notificacionesRestantes;
                } else {
                    counter.classList.add('d-none');
                }
            }, 300);
        }

        function actualizarAlertasRecientes() {
            const container = document.getElementById('alertas-recientes');
            const alertasRecientes = notificaciones.slice(0, 3);
            
            if (alertasRecientes.length === 0) {
                container.innerHTML = '<p class="text-muted text-center">No hay alertas recientes</p>';
                return;
            }

            const html = alertasRecientes.map(notif => `
                <div class="d-flex align-items-center border-bottom py-2">
                    <div class="flex-shrink-0">
                        <i class="fas ${notif.icono} text-${notif.tipo}"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <small class="d-block">${notif.mensaje}</small>
                        <small class="text-muted">${notif.fecha.toLocaleDateString('es-ES')}</small>
                    </div>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        // ========== MÓDULO DE REPORTES PDF ==========
        function generarReporteGeneral() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Título
            doc.setFontSize(20);
            doc.text('REPORTE GENERAL DE EMPLEADOS', 105, 15, { align: 'center' });
            
            // Fecha
            doc.setFontSize(10);
            doc.text(`Generado: ${new Date().toLocaleDateString('es-ES')}`, 105, 22, { align: 'center' });
            
            // Tabla
            const headers = [['ID', 'Nombre', 'Sucursal', 'Puesto', 'Antigüedad', 'Salario']];
            const data = empleados.map(emp => [
                emp.id_empleado,
                `${emp.nombre} ${emp.apellido}`,
                emp.sucursal,
                emp.puesto,
                `${calcularAntiguedad(emp.fecha_contratacion)} años`,
                `$${parseFloat(emp.salario_base).toLocaleString('es-ES')}`
            ]);
            
            doc.autoTable({
                head: headers,
                body: data,
                startY: 30,
                styles: { fontSize: 8 },
                headStyles: { fillColor: [41, 128, 185] }
            });
            
            // Pie de página
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.text(`Página ${i} de ${pageCount}`, 105, 285, { align: 'center' });
            }
            
            doc.save('reporte_empleados_general.pdf');
        }

        function generarReporteVacaciones() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.text('REPORTE DE VACACIONES', 105, 15, { align: 'center' });
            doc.setFontSize(10);
            doc.text(`Generado: ${new Date().toLocaleDateString('es-ES')}`, 105, 22, { align: 'center' });
            
            const headers = [['Empleado', 'Sucursal', 'Antigüedad', 'Vac. Acumuladas', 'Vac. Tomadas', 'Vac. Pendientes']];
            const data = empleados.map(emp => {
                const antiguedad = calcularAntiguedad(emp.fecha_contratacion);
                const vacacionesAcumuladas = calcularVacaciones(antiguedad);
                const vacacionesPendientes = Math.max(0, vacacionesAcumuladas - (emp.dias_vacaciones_tomados || 0));
                
                return [
                    `${emp.nombre} ${emp.apellido}`,
                    emp.sucursal,
                    `${antiguedad} años`,
                    `${vacacionesAcumuladas} días`,
                    `${emp.dias_vacaciones_tomados || 0} días`,
                    `${vacacionesPendientes} días`
                ];
            });
            
            doc.autoTable({
                head: headers,
                body: data,
                startY: 30,
                styles: { fontSize: 8 },
                headStyles: { fillColor: [230, 126, 34] }
            });
            
            doc.save('reporte_vacaciones.pdf');
        }

        function generarReporteSucursales() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.text('REPORTE POR SUCURSALES', 105, 15, { align: 'center' });
            doc.setFontSize(10);
            doc.text(`Generado: ${new Date().toLocaleDateString('es-ES')}`, 105, 22, { align: 'center' });
            
            const sucursales = {};
            empleados.forEach(emp => {
                const sucursal = emp.sucursal || 'CC';
                if (!sucursales[sucursal]) {
                    sucursales[sucursal] = { empleados: [], totalSalarios: 0 };
                }
                sucursales[sucursal].empleados.push(emp);
                sucursales[sucursal].totalSalarios += parseFloat(emp.salario_base || 0);
            });
            
            let yPos = 30;
            Object.keys(sucursales).sort().forEach(sucursal => {
                const data = sucursales[sucursal];
                const promedioSalario = data.totalSalarios / data.empleados.length;
                
                doc.setFontSize(12);
                doc.setTextColor(41, 128, 185);
                doc.text(`Sucursal ${sucursal} - ${data.empleados.length} empleados`, 14, yPos);
                yPos += 7;
                
                doc.setFontSize(8);
                doc.setTextColor(0, 0, 0);
                doc.text(`Salario promedio: $${promedioSalario.toLocaleString('es-ES', {maximumFractionDigits: 0})}`, 14, yPos);
                yPos += 5;
                
                const headers = [['Nombre', 'Puesto', 'Antigüedad', 'Salario']];
                const empleadosData = data.empleados.map(emp => [
                    `${emp.nombre} ${emp.apellido}`,
                    emp.puesto,
                    `${calcularAntiguedad(emp.fecha_contratacion)} años`,
                    `$${parseFloat(emp.salario_base).toLocaleString('es-ES')}`
                ]);
                
                doc.autoTable({
                    head: headers,
                    body: empleadosData,
                    startY: yPos,
                    styles: { fontSize: 7 },
                    headStyles: { fillColor: [52, 152, 219] },
                    margin: { left: 14 }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                if (yPos > 250) {
                    doc.addPage();
                    yPos = 20;
                }
            });
            
            doc.save('reporte_sucursales.pdf');
        }

        function exportarAExcel() {
            let csvContent = "data:text/csv;charset=utf-8,";
            
            // Encabezados
            const headers = ['ID', 'Nombre', 'Apellido', 'Sucursal', 'Puesto', 'Fecha Contratación', 'Antigüedad', 'Salario Base', 'Vacaciones Tomadas'];
            csvContent += headers.join(',') + '\r\n';
            
            // Datos
            empleados.forEach(emp => {
                const antiguedad = calcularAntiguedad(emp.fecha_contratacion);
                const row = [
                    emp.id_empleado,
                    emp.nombre,
                    emp.apellido,
                    emp.sucursal,
                    emp.puesto,
                    emp.fecha_contratacion,
                    antiguedad,
                    emp.salario_base,
                    emp.dias_vacaciones_tomados || 0
                ];
                csvContent += row.join(',') + '\r\n';
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "empleados.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function generarReporteEstadisticas() {
            alert('Generando reporte de estadísticas...');
            // En una implementación real, aquí irían gráficos y análisis detallados
        }
    </script>
</body>
</html>
